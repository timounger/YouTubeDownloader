name: Import Labels

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  import_labels:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 14

      - name: Install dependencies and run workflow
        run: |
          npm install @octokit/rest
          node -e "
          const core = require('@actions/core');
          const { Octokit } = require('@octokit/rest');
          const fs = require('fs');
          
          const token = process.env.GITHUB_TOKEN;
          const octokit = new Octokit({ auth: token });
          const owner = process.env.GITHUB_REPOSITORY_OWNER;
          const repo = process.env.GITHUB_REPOSITORY;
          
          try {
            const yaml = require('js-yaml');
            const labels = yaml.safeLoad(fs.readFileSync('.github/issues/labels.yml', 'utf8'));
            
            for (const label of labels.labels) {
              octokit.issues.createLabel({
                owner,
                repo,
                name: label.name,
                color: label.color,
                description: label.description
              });
            }
          } catch (error) {
            core.setFailed(error.message);
          }
          "

        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
